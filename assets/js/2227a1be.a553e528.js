"use strict";(self.webpackChunkkmp_iap_docs=self.webpackChunkkmp_iap_docs||[]).push([[7399],{8453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>o});var r=i(6540);const a={},l=r.createContext(a);function s(e){const n=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),r.createElement(l.Provider,{value:n},e.children)}},9643:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>t,contentTitle:()=>s,default:()=>p,frontMatter:()=>l,metadata:()=>o,toc:()=>d});var r=i(4848),a=i(8453);const l={slug:"release-1.2.0",title:"1.2.0 - Billing Programs API & One-Time Product Discounts",authors:["hyochan"],tags:["release","android","google-play-billing","billing-programs","discounts","breaking-change"],description:"KMP-IAP 1.2.0 brings Google Play Billing Library 8.2.0 features including the new Billing Programs API for external billing and one-time product discount support.",date:new Date("2025-12-16T00:00:00.000Z")},s="KMP-IAP 1.2.0",o={permalink:"/kmp-iap/blog/release-1.2.0",editUrl:"https://github.com/hyochan/kmp-iap/tree/main/docs/blog/2025-12-16-release-1.2.0.md",source:"@site/blog/2025-12-16-release-1.2.0.md",title:"1.2.0 - Billing Programs API & One-Time Product Discounts",description:"KMP-IAP 1.2.0 brings Google Play Billing Library 8.2.0 features including the new Billing Programs API for external billing and one-time product discount support.",date:"2025-12-16T00:00:00.000Z",formattedDate:"December 16, 2025",tags:[{label:"release",permalink:"/kmp-iap/blog/tags/release"},{label:"android",permalink:"/kmp-iap/blog/tags/android"},{label:"google-play-billing",permalink:"/kmp-iap/blog/tags/google-play-billing"},{label:"billing-programs",permalink:"/kmp-iap/blog/tags/billing-programs"},{label:"discounts",permalink:"/kmp-iap/blog/tags/discounts"},{label:"breaking-change",permalink:"/kmp-iap/blog/tags/breaking-change"}],readingTime:4.705,hasTruncateMarker:!0,authors:[{name:"Hyo",title:"Maintainer of kmp-iap",url:"https://github.com/hyochan",imageURL:"https://github.com/hyochan.png",key:"hyochan"}],frontMatter:{slug:"release-1.2.0",title:"1.2.0 - Billing Programs API & One-Time Product Discounts",authors:["hyochan"],tags:["release","android","google-play-billing","billing-programs","discounts","breaking-change"],description:"KMP-IAP 1.2.0 brings Google Play Billing Library 8.2.0 features including the new Billing Programs API for external billing and one-time product discount support.",date:"2025-12-16T00:00:00.000Z"},unlisted:!1,prevItem:{title:"1.2.1 - OpenIAP Updates & DSL Enhancements",permalink:"/kmp-iap/blog/release-1.2.1"},nextItem:{title:"1.0.0 - Built-in Purchase Verification (aka Receipt Validation)",permalink:"/kmp-iap/blog/release-1.0.0"}},t={authorsImageUrls:[void 0]},d=[{value:"New Features",id:"new-features",level:2},{value:"1. Billing Programs API (Android 8.2.0+)",id:"1-billing-programs-api-android-820",level:3},{value:"2. One-Time Product Discounts (Android 7.0+)",id:"2-one-time-product-discounts-android-70",level:3},{value:"3. Purchase Suspension Status (Android 8.1.0+)",id:"3-purchase-suspension-status-android-810",level:3},{value:"Breaking Changes",id:"breaking-changes",level:2},{value:"1. <code>oneTimePurchaseOfferDetailsAndroid</code> Type Change",id:"1-onetimepurchaseofferdetailsandroid-type-change",level:3},{value:"2. <code>VerifyPurchaseProps</code> API Change",id:"2-verifypurchaseprops-api-change",level:3},{value:"New Types",id:"new-types",level:2},{value:"Billing Programs API Types",id:"billing-programs-api-types",level:3},{value:"One-Time Product Discount Types",id:"one-time-product-discount-types",level:3},{value:"Purchase Verification Types",id:"purchase-verification-types",level:3},{value:"OpenIAP Updates",id:"openiap-updates",level:2},{value:"Installation",id:"installation",level:2},{value:"Gradle (Kotlin DSL)",id:"gradle-kotlin-dsl",level:3},{value:"Version Catalog (libs.versions.toml)",id:"version-catalog-libsversionstoml",level:3},{value:"References",id:"references",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["KMP-IAP 1.2.0 brings ",(0,r.jsx)(n.strong,{children:"Google Play Billing Library 8.2.0"})," features including the new ",(0,r.jsx)(n.strong,{children:"Billing Programs API"})," for external billing and ",(0,r.jsx)(n.strong,{children:"one-time product discount support"})," from Billing Library 7.0+."]}),"\n",(0,r.jsx)(n.h2,{id:"new-features",children:"New Features"}),"\n",(0,r.jsx)(n.h3,{id:"1-billing-programs-api-android-820",children:"1. Billing Programs API (Android 8.2.0+)"}),"\n",(0,r.jsx)(n.p,{children:"New methods for handling external billing programs:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"isBillingProgramAvailable(program)"})," - Check if a billing program is available for the user"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"createBillingProgramReportingDetails(program)"})," - Get external transaction token for reporting"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"launchExternalLink(params)"})," - Launch external link for billing programs"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Supported Programs:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ExternalOffer"})," - External offer programs"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ExternalContentLink"})," - External content link programs"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-kotlin",children:'import io.github.hyochan.kmpiap.kmpIapInstance\nimport io.github.hyochan.kmpiap.openiap.*\n\n// Step 1: Check availability\nval result = kmpIapInstance.isBillingProgramAvailable(BillingProgram.ExternalOffer)\nif (!result.isAvailable) return\n\n// Step 2: Launch external link\nkmpIapInstance.launchExternalLink(\n    LaunchExternalLinkParams(\n        billingProgram = BillingProgram.ExternalOffer,\n        launchMode = ExternalLinkLaunchMode.LaunchInExternalBrowserOrApp,\n        linkType = ExternalLinkType.LinkToDigitalContentOffer,\n        linkUri = "https://your-payment-site.com"\n    )\n)\n\n// Step 3: Get reporting token\nval details = kmpIapInstance.createBillingProgramReportingDetails(BillingProgram.ExternalOffer)\n// Report token to Google Play within 24 hours\n'})}),"\n",(0,r.jsx)(n.admonition,{title:"Availability Note",type:"info",children:(0,r.jsxs)(n.p,{children:["The Billing Programs API methods currently return ",(0,r.jsx)(n.code,{children:"FeatureNotSupported"})," error as the underlying Google Play Billing Library 8.2.0 APIs are not yet available in the billing-ktx dependency. The types and methods are provided for future compatibility."]})}),"\n",(0,r.jsx)(n.h3,{id:"2-one-time-product-discounts-android-70",children:"2. One-Time Product Discounts (Android 7.0+)"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"oneTimePurchaseOfferDetailsAndroid"})," is now an ",(0,r.jsx)(n.strong,{children:"array"})," to support multiple offers with discounts."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"New Fields:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"offerId"})," - Unique offer identifier"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"offerTags"})," - Tags for categorizing offers"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"offerToken"})," - Token for purchasing specific offer"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"discountDisplayInfo"})," - Percentage and amount discount info"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"limitedQuantityInfo"})," - Purchase quantity limits"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"validTimeWindow"})," - Offer validity period"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"preorderDetails"})," - Preorder release info (8.1.0+)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"rentalDetails"})," - Rental period info"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"3-purchase-suspension-status-android-810",children:"3. Purchase Suspension Status (Android 8.1.0+)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Added ",(0,r.jsx)(n.code,{children:"isSuspendedAndroid"})," field to ",(0,r.jsx)(n.code,{children:"PurchaseAndroid"})," type"]}),"\n",(0,r.jsx)(n.li,{children:"Indicates when a subscription is suspended due to payment issues"}),"\n",(0,r.jsx)(n.li,{children:"Users should be directed to fix payment method when suspended"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-kotlin",children:"if (purchase.isSuspendedAndroid == true) {\n    // Show UI to direct user to fix payment method\n    showPaymentIssueDialog()\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"breaking-changes",children:"Breaking Changes"}),"\n",(0,r.jsxs)(n.h3,{id:"1-onetimepurchaseofferdetailsandroid-type-change",children:["1. ",(0,r.jsx)(n.code,{children:"oneTimePurchaseOfferDetailsAndroid"})," Type Change"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Before (1.0.0):"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-kotlin",children:"val price = product.oneTimePurchaseOfferDetailsAndroid?.formattedPrice\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"After (1.2.0):"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-kotlin",children:"val price = product.oneTimePurchaseOfferDetailsAndroid?.firstOrNull()?.formattedPrice\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Migration:"})," Update code that accesses this field to handle arrays:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-kotlin",children:'// Access first offer (most common case)\nval offers = product.oneTimePurchaseOfferDetailsAndroid\nval price = offers?.firstOrNull()?.formattedPrice\n\n// Or iterate through all offers\noffers?.forEach { offer ->\n    println("Offer: ${offer.offerId}, Price: ${offer.formattedPrice}")\n    offer.discountDisplayInfo?.let { discount ->\n        println("Discount: ${discount.percentageDiscount}%")\n    }\n}\n'})}),"\n",(0,r.jsxs)(n.h3,{id:"2-verifypurchaseprops-api-change",children:["2. ",(0,r.jsx)(n.code,{children:"VerifyPurchaseProps"})," API Change"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"VerifyPurchaseProps"})," now uses platform-specific nested options instead of a root ",(0,r.jsx)(n.code,{children:"sku"})," field."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Before (1.0.0):"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-kotlin",children:'val result = kmpIapInstance.verifyPurchase(\n    VerifyPurchaseProps(\n        sku = "premium_upgrade",\n        androidOptions = VerifyPurchaseAndroidOptions(\n            accessToken = token,\n            packageName = "com.yourapp.id",\n            productToken = purchaseToken,\n            isSub = false\n        )\n    )\n)\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"After (1.2.0):"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-kotlin",children:'// iOS verification\nval iosResult = kmpIapInstance.verifyPurchase(\n    VerifyPurchaseProps(\n        apple = VerifyPurchaseAppleOptions(sku = "premium_upgrade")\n    )\n)\n\n// Android verification\nval androidResult = kmpIapInstance.verifyPurchase(\n    VerifyPurchaseProps(\n        google = VerifyPurchaseGoogleOptions(\n            sku = "premium_upgrade",\n            accessToken = backendProvidedToken, // Get from your secure backend\n            packageName = "com.yourapp.id",\n            purchaseToken = purchase.purchaseToken ?: "",\n            isSub = false\n        )\n    )\n)\n\n// Meta Quest (Horizon) verification\nval horizonResult = kmpIapInstance.verifyPurchase(\n    VerifyPurchaseProps(\n        horizon = VerifyPurchaseHorizonOptions(\n            sku = "premium_upgrade",\n            userId = userId,\n            accessToken = backendProvidedToken\n        )\n    )\n)\n'})}),"\n",(0,r.jsx)(n.admonition,{title:"Security Note",type:"warning",children:(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"accessToken"})," for Google and Horizon verification must be obtained from your secure backend. Never hardcode or store API credentials in your app."]})}),"\n",(0,r.jsx)(n.h2,{id:"new-types",children:"New Types"}),"\n",(0,r.jsx)(n.h3,{id:"billing-programs-api-types",children:"Billing Programs API Types"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-kotlin",children:"// Billing program type\nenum class BillingProgram {\n    Unspecified,\n    ExternalContentLink,\n    ExternalOffer\n}\n\n// Launch mode for external links\nenum class ExternalLinkLaunchMode {\n    Unspecified,\n    LaunchInExternalBrowserOrApp,\n    CallerWillLaunchLink\n}\n\n// Link type for external links\nenum class ExternalLinkType {\n    Unspecified,\n    LinkToDigitalContentOffer,\n    LinkToAppDownload\n}\n\n// Parameters for launching external links\ndata class LaunchExternalLinkParams(\n    val billingProgram: BillingProgram,\n    val launchMode: ExternalLinkLaunchMode,\n    val linkType: ExternalLinkType,\n    val linkUri: String\n)\n\n// Result types\ndata class BillingProgramAvailabilityResult(\n    val billingProgram: BillingProgram,\n    val isAvailable: Boolean\n)\n\ndata class BillingProgramReportingDetails(\n    val billingProgram: BillingProgram,\n    val externalTransactionToken: String\n)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"one-time-product-discount-types",children:"One-Time Product Discount Types"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-kotlin",children:"// Discount display information\ndata class DiscountDisplayInfoAndroid(\n    val percentageDiscount: Int? = null,\n    val discountAmount: DiscountAmountAndroid? = null\n)\n\n// Discount amount details\ndata class DiscountAmountAndroid(\n    val discountAmountMicros: String,\n    val formattedDiscountAmount: String\n)\n\n// Limited quantity information\ndata class LimitedQuantityInfoAndroid(\n    val maximumQuantity: Int,\n    val remainingQuantity: Int\n)\n\n// Offer validity period\ndata class ValidTimeWindowAndroid(\n    val startTimeMillis: String,\n    val endTimeMillis: String\n)\n\n// Pre-order details (8.1.0+)\ndata class PreorderDetailsAndroid(\n    val preorderReleaseTimeMillis: String,\n    val preorderPresaleEndTimeMillis: String\n)\n\n// Rental details\ndata class RentalDetailsAndroid(\n    val rentalPeriod: String,\n    val rentalExpirationPeriod: String? = null\n)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"purchase-verification-types",children:"Purchase Verification Types"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-kotlin",children:'// Platform-specific verification options (NEW in 1.2.0)\ndata class VerifyPurchaseProps(\n    val apple: VerifyPurchaseAppleOptions? = null,\n    val google: VerifyPurchaseGoogleOptions? = null,\n    val horizon: VerifyPurchaseHorizonOptions? = null\n)\n\ndata class VerifyPurchaseAppleOptions(\n    val sku: String\n)\n\ndata class VerifyPurchaseGoogleOptions(\n    val sku: String,\n    val accessToken: String,      // Obtain from your backend\n    val packageName: String,\n    val purchaseToken: String,\n    val isSub: Boolean? = null\n)\n\ndata class VerifyPurchaseHorizonOptions(\n    val sku: String,\n    val userId: String,\n    val accessToken: String       // Obtain from your backend\n)\n\n// Deprecated (use VerifyPurchaseGoogleOptions instead)\n@Deprecated("Use VerifyPurchaseGoogleOptions instead")\ntypealias VerifyPurchaseAndroidOptions = VerifyPurchaseGoogleOptions\n'})}),"\n",(0,r.jsx)(n.h2,{id:"openiap-updates",children:"OpenIAP Updates"}),"\n",(0,r.jsx)(n.p,{children:"Updated OpenIAP versions:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"openiap-apple"}),": ",(0,r.jsx)(n.a,{href:"https://github.com/hyodotdev/openiap/compare/1.3.0...1.3.5",children:"1.3.0 -> 1.3.5"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"openiap-google"}),": ",(0,r.jsx)(n.a,{href:"https://github.com/hyodotdev/openiap/compare/google-1.3.10...google-1.3.14",children:"1.3.10 -> 1.3.14"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"openiap-gql"}),": ",(0,r.jsx)(n.a,{href:"https://github.com/hyodotdev/openiap/compare/gql-1.3.0...gql-1.3.5",children:"1.3.0 -> 1.3.5"})]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,r.jsx)(n.h3,{id:"gradle-kotlin-dsl",children:"Gradle (Kotlin DSL)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-kotlin",children:'// shared/build.gradle.kts\nkotlin {\n    sourceSets {\n        commonMain.dependencies {\n            implementation("io.github.hyochan:kmp-iap:1.2.0")\n        }\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"version-catalog-libsversionstoml",children:"Version Catalog (libs.versions.toml)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",children:'[versions]\nkmp-iap = "1.2.0"\n\n[libraries]\nkmp-iap = { module = "io.github.hyochan:kmp-iap", version.ref = "kmp-iap" }\n'})}),"\n",(0,r.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://developer.android.com/google/play/billing/release-notes#8-2-0",children:"Google Play Billing Library 8.2.0 Release Notes"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://developer.android.com/google/play/billing/billing-programs",children:"Google Play Billing Programs"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://developer.android.com/google/play/billing/integrate#one-time-discounts",children:"Google Play One-Time Product Discounts"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/docs/api/core-methods",children:"API Reference - Core Methods"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/docs/api/types",children:"API Reference - Types"})}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Questions or feedback? Reach out via ",(0,r.jsx)(n.a,{href:"https://github.com/hyochan/kmp-iap/issues",children:"GitHub Issues"})," or join our ",(0,r.jsx)(n.a,{href:"https://hyo.dev/joinSlack",children:"Slack community"}),"."]})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}}}]);