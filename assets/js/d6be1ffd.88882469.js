"use strict";(self.webpackChunkkmp_iap_docs=self.webpackChunkkmp_iap_docs||[]).push([[2945],{3258:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>t,metadata:()=>o,toc:()=>c});var s=r(4848),i=r(8453);const t={sidebar_position:1},a="API Overview",o={id:"api/overview",title:"API Overview",description:"KMP IAP provides a comprehensive API for handling in-app purchases across platforms. This overview covers the main components and their usage.",source:"@site/versioned_docs/version-1.0.0-beta/api/overview.md",sourceDirName:"api",slug:"/api/overview",permalink:"/kmp-iap/docs/1.0.0-beta/api/overview",draft:!1,unlisted:!1,editUrl:"https://github.com/hyochan/kmp-iap/tree/main/docs/versioned_docs/version-1.0.0-beta/api/overview.md",tags:[],version:"1.0.0-beta",sidebarPosition:1,frontMatter:{sidebar_position:1}},l={},c=[{value:"Core Components",id:"core-components",level:2},{value:"KmpIAP Class",id:"kmpiap-class",level:3},{value:"1. Instance Creation (Recommended)",id:"1-instance-creation-recommended",level:4},{value:"2. Singleton Pattern (Deprecated)",id:"2-singleton-pattern-deprecated",level:4},{value:"KmpInAppPurchase Interface",id:"kmpinapppurchase-interface",level:3},{value:"Data Types",id:"data-types",level:2},{value:"Product Types",id:"product-types",level:3},{value:"Store Types",id:"store-types",level:3},{value:"Error Codes",id:"error-codes",level:3},{value:"Request/Response Models",id:"requestresponse-models",level:2},{value:"ProductRequest",id:"productrequest",level:3},{value:"UnifiedPurchaseRequest",id:"unifiedpurchaserequest",level:3},{value:"Product Models",id:"product-models",level:3},{value:"Event Handling",id:"event-handling",level:2},{value:"Purchase Updates",id:"purchase-updates",level:3},{value:"Error Handling",id:"error-handling",level:3},{value:"Platform Considerations",id:"platform-considerations",level:2},{value:"Android",id:"android",level:3},{value:"iOS",id:"ios",level:3},{value:"Best Practices",id:"best-practices",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"api-overview",children:"API Overview"}),"\n",(0,s.jsx)(n.p,{children:"KMP IAP provides a comprehensive API for handling in-app purchases across platforms. This overview covers the main components and their usage."}),"\n",(0,s.jsx)(n.h2,{id:"core-components",children:"Core Components"}),"\n",(0,s.jsx)(n.h3,{id:"kmpiap-class",children:"KmpIAP Class"}),"\n",(0,s.jsx)(n.p,{children:"The main class for all IAP operations. You can use it in two ways:"}),"\n",(0,s.jsx)(n.h4,{id:"1-instance-creation-recommended",children:"1. Instance Creation (Recommended)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"import io.github.hyochan.kmpiap.KmpIAP\n\n// Create your own instance\nval kmpIAP = KmpIAP()\nkmpIAP.initConnection()\nkmpIAP.requestProducts(...)\n"})}),"\n",(0,s.jsx)(n.h4,{id:"2-singleton-pattern-deprecated",children:"2. Singleton Pattern (Deprecated)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"import io.github.hyochan.kmpiap.KmpIAP\n\n// Use the global singleton instance (deprecated)\nKmpIAP.instance.initConnection()\nKmpIAP.instance.requestProducts(...)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"kmpinapppurchase-interface",children:"KmpInAppPurchase Interface"}),"\n",(0,s.jsx)(n.p,{children:"The main interface implemented by KmpIAP:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"interface KmpInAppPurchase {\n    // Connection management\n    suspend fun initConnection(): Boolean\n    suspend fun endConnection(): Boolean\n    fun getStore(): Store\n    suspend fun canMakePayments(): Boolean\n    \n    // Product management\n    suspend fun requestProducts(params: ProductRequest): List<Product>\n    suspend fun getAvailablePurchases(options: PurchaseOptions? = null): List<Purchase>\n    suspend fun getPurchaseHistories(options: PurchaseOptions? = null): List<ProductPurchase>\n    \n    // Purchase operations\n    suspend fun requestPurchase(request: UnifiedPurchaseRequest): Purchase\n    suspend fun finishTransaction(purchase: Purchase, isConsumable: Boolean? = null)\n    \n    // Validation\n    suspend fun validateReceipt(options: ValidationOptions): ValidationResult\n    suspend fun isPurchaseValid(purchase: Purchase): Boolean\n    \n    // Platform-specific (iOS)\n    suspend fun finishTransactionIOS(transactionId: String)\n    suspend fun clearTransactionIOS()\n    suspend fun clearProductsIOS()\n    suspend fun getStorefrontIOS(): String\n    suspend fun presentCodeRedemptionSheetIOS()\n    suspend fun getPromotedProductIOS(): String?\n    suspend fun buyPromotedProductIOS()\n    \n    // Platform-specific (Android)\n    suspend fun acknowledgePurchaseAndroid(purchaseToken: String)\n    suspend fun consumePurchaseAndroid(purchaseToken: String)\n    \n    // Subscription management\n    suspend fun deepLinkToSubscriptions(options: DeepLinkOptions)\n    \n    // Event listeners\n    val purchaseUpdatedListener: Flow<Purchase>\n    val purchaseErrorListener: Flow<PurchaseError>\n    val promotedProductListener: Flow<String?>\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"data-types",children:"Data Types"}),"\n",(0,s.jsx)(n.h3,{id:"product-types",children:"Product Types"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"enum class ProductType {\n    INAPP,  // One-time purchases\n    SUBS    // Subscriptions\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"store-types",children:"Store Types"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"enum class Store {\n    PLAY_STORE,    // Google Play Store\n    APP_STORE,     // Apple App Store\n    STRIPE,        // Stripe (future)\n    NONE           // No store available\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"error-codes",children:"Error Codes"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"enum class ErrorCode {\n    E_OK,\n    E_USER_CANCELLED,\n    E_NETWORK_ERROR,\n    E_SERVICE_ERROR,\n    E_ITEM_UNAVAILABLE,\n    E_ITEM_ALREADY_OWNED,\n    E_REMOTE_ERROR,\n    E_DEVELOPER_ERROR,\n    E_BILLING_RESPONSE_JSON_PARSE_ERROR,\n    E_UNKNOWN,\n    E_PENDING,\n    E_NOT_PREPARED,\n    E_ALREADY_PREPARED\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"requestresponse-models",children:"Request/Response Models"}),"\n",(0,s.jsx)(n.h3,{id:"productrequest",children:"ProductRequest"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"data class ProductRequest(\n    val skus: List<String>,\n    val type: ProductType\n)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"unifiedpurchaserequest",children:"UnifiedPurchaseRequest"}),"\n",(0,s.jsx)(n.p,{children:"Unified purchase request for all platforms:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"data class UnifiedPurchaseRequest(\n    val sku: String,\n    val quantity: Int = 1,\n    // Android-specific\n    val obfuscatedAccountIdAndroid: String? = null,\n    val obfuscatedProfileIdAndroid: String? = null,\n    val replacementMode: AndroidProrationMode? = null,\n    // iOS-specific\n    val appAccountToken: String? = null,\n    val discount: RequestedDiscount? = null,\n    val requestId: String? = null\n)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"product-models",children:"Product Models"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"// Base product interface\ninterface BaseProduct {\n    val productId: String\n    val price: String\n    val currency: String\n    val localizedPrice: String\n    val title: String\n    val description: String\n}\n\n// One-time purchase product\ndata class Product(\n    override val productId: String,\n    override val price: String,\n    override val currency: String,\n    override val localizedPrice: String,\n    override val title: String,\n    override val description: String,\n    val priceAmountMicros: Long,\n    val oneTimePurchaseOfferDetails: OneTimePurchaseOfferDetails?\n) : BaseProduct\n\n// Subscription product\ndata class Subscription(\n    override val productId: String,\n    override val price: String,\n    override val currency: String,\n    override val localizedPrice: String,\n    override val title: String,\n    override val description: String,\n    val subscriptionOfferDetails: List<SubscriptionOfferDetails>?\n) : BaseProduct\n"})}),"\n",(0,s.jsx)(n.h2,{id:"event-handling",children:"Event Handling"}),"\n",(0,s.jsx)(n.h3,{id:"purchase-updates",children:"Purchase Updates"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"val kmpIAP = KmpIAP()\nkmpIAP.purchaseUpdatedListener.collect { purchase ->\n    when (purchase.purchaseState) {\n        PurchaseState.PURCHASED -> {\n            // Handle successful purchase\n        }\n        PurchaseState.PENDING -> {\n            // Handle pending purchase\n        }\n        PurchaseState.UNSPECIFIED -> {\n            // Handle unspecified state\n        }\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"error-handling",children:"Error Handling"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"val kmpIAP = KmpIAP()\nkmpIAP.purchaseErrorListener.collect { error ->\n    when (error.code) {\n        ErrorCode.E_USER_CANCELLED -> {\n            // User cancelled the purchase\n        }\n        ErrorCode.E_ITEM_UNAVAILABLE -> {\n            // Item not available\n        }\n        else -> {\n            // Handle other errors\n        }\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"platform-considerations",children:"Platform Considerations"}),"\n",(0,s.jsx)(n.h3,{id:"android",children:"Android"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Uses Google Play Billing Library v8"}),"\n",(0,s.jsx)(n.li,{children:"Supports pending transactions"}),"\n",(0,s.jsx)(n.li,{children:"Handles obfuscated account IDs"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"ios",children:"iOS"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Uses StoreKit 2 (iOS 15+)"}),"\n",(0,s.jsx)(n.li,{children:"Supports promotional offers"}),"\n",(0,s.jsx)(n.li,{children:"Handles receipt validation"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Always initialize connection before any operations"}),"\n",(0,s.jsx)(n.li,{children:"Handle all error cases appropriately"}),"\n",(0,s.jsx)(n.li,{children:"Finish transactions promptly"}),"\n",(0,s.jsx)(n.li,{children:"Validate receipts on your server"}),"\n",(0,s.jsx)(n.li,{children:"Test thoroughly with sandbox/test accounts"}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>o});var s=r(6540);const i={},t=s.createContext(i);function a(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);