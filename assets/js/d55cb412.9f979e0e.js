"use strict";(self.webpackChunkkmp_iap_docs=self.webpackChunkkmp_iap_docs||[]).push([[7517],{3487:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>d,contentTitle:()=>t,default:()=>u,frontMatter:()=>o,metadata:()=>c,toc:()=>a});var i=s(4848),r=s(8453),l=s(5159);const o={sidebar_position:9,title:"Troubleshooting"},t="Troubleshooting",c={id:"guides/troubleshooting",title:"Troubleshooting",description:"Common issues and solutions when implementing in-app purchases with kmp-iap.",source:"@site/versioned_docs/version-1.0.0-rc/guides/troubleshooting.md",sourceDirName:"guides",slug:"/guides/troubleshooting",permalink:"/kmp-iap/docs/1.0.0-rc/guides/troubleshooting",draft:!1,unlisted:!1,editUrl:"https://github.com/hyochan/kmp-iap/tree/main/docs/versioned_docs/version-1.0.0-rc/guides/troubleshooting.md",tags:[],version:"1.0.0-rc",sidebarPosition:9,frontMatter:{sidebar_position:9,title:"Troubleshooting"},sidebar:"docsSidebar",previous:{title:"Alternative Billing",permalink:"/kmp-iap/docs/1.0.0-rc/guides/alternative-billing"},next:{title:"FAQ",permalink:"/kmp-iap/docs/1.0.0-rc/guides/faq"}},d={},a=[{value:"Installation &amp; Setup Issues",id:"installation--setup-issues",level:2},{value:"Gradle Configuration Problems",id:"gradle-configuration-problems",level:3},{value:"iOS Build Issues",id:"ios-build-issues",level:3},{value:"Android Build Issues",id:"android-build-issues",level:3},{value:"Connection &amp; Initialization Issues",id:"connection--initialization-issues",level:2},{value:"&quot;Billing is unavailable&quot; Error",id:"billing-is-unavailable-error",level:3},{value:"iOS Connection Issues",id:"ios-connection-issues",level:3},{value:"Product Loading Issues",id:"product-loading-issues",level:2},{value:"Products Not Loading",id:"products-not-loading",level:3},{value:"iOS Products Not Loading",id:"ios-products-not-loading",level:3},{value:"Android Products Not Loading",id:"android-products-not-loading",level:3},{value:"Purchase Issues",id:"purchase-issues",level:2},{value:"Purchase Flow Not Working",id:"purchase-flow-not-working",level:3},{value:"Transaction Not Completing",id:"transaction-not-completing",level:3},{value:"&quot;Already Owned&quot; Error",id:"already-owned-error",level:3},{value:"Testing Issues",id:"testing-issues",level:2},{value:"Sandbox Testing Problems (iOS)",id:"sandbox-testing-problems-ios",level:3},{value:"Test Purchases Not Working (Android)",id:"test-purchases-not-working-android",level:3},{value:"Runtime Errors",id:"runtime-errors",level:2},{value:"StateFlow Collection Errors",id:"stateflow-collection-errors",level:3},{value:"Memory Leaks",id:"memory-leaks",level:3},{value:"Receipt Validation Issues",id:"receipt-validation-issues",level:2},{value:"iOS Receipt Validation",id:"ios-receipt-validation",level:3},{value:"Android Receipt Validation",id:"android-receipt-validation",level:3},{value:"Debug Tools",id:"debug-tools",level:2},{value:"Enable Debug Logging",id:"enable-debug-logging",level:3},{value:"Check Connection Status",id:"check-connection-status",level:3},{value:"Common Error Codes",id:"common-error-codes",level:2},{value:"Understanding Error Codes",id:"understanding-error-codes",level:3},{value:"Getting Help",id:"getting-help",level:2},{value:"Issue Report Template",id:"issue-report-template",level:3}];function h(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.h1,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,i.jsx)(l.A,{}),"\n",(0,i.jsx)(e.p,{children:"Common issues and solutions when implementing in-app purchases with kmp-iap."}),"\n",(0,i.jsx)(e.h2,{id:"installation--setup-issues",children:"Installation & Setup Issues"}),"\n",(0,i.jsx)(e.h3,{id:"gradle-configuration-problems",children:"Gradle Configuration Problems"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Problem:"})," Build fails with dependency conflicts"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Solution:"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-kotlin",children:'// In your module\'s build.gradle.kts\ndependencies {\n    implementation("io.github.hyochan:kmp-iap:<version>")\n\n    // Ensure correct Kotlin version\n    implementation("org.jetbrains.kotlin:kotlin-stdlib:<version>")\n}\n\n// Clean and rebuild\n./gradlew clean\n./gradlew build\n'})}),"\n",(0,i.jsx)(e.h3,{id:"ios-build-issues",children:"iOS Build Issues"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Problem:"})," Build fails with StoreKit related errors"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Solution:"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Ensure iOS deployment target is 15.0+:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-ruby",children:"# In your iOS project settings\nplatform :ios, '15.0'\n"})}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Clean and rebuild:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"cd iosApp\nrm -rf build\npod deintegrate\npod install\ncd ..\n./gradlew clean\n./gradlew build\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"android-build-issues",children:"Android Build Issues"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Problem:"})," Build fails with billing library conflicts"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Solution:"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:["Check ",(0,i.jsx)(e.code,{children:"android"})," block in build.gradle.kts:"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-kotlin",children:"android {\n    compileSdk = 34\n\n    defaultConfig {\n        minSdk = 24  // Required minimum\n    }\n}\n"})}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Add billing permission to AndroidManifest.xml:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:'<uses-permission android:name="com.android.vending.BILLING" />\n'})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"connection--initialization-issues",children:"Connection & Initialization Issues"}),"\n",(0,i.jsx)(e.h3,{id:"billing-is-unavailable-error",children:'"Billing is unavailable" Error'}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Problem:"})," IAP initialization returns billing unavailable error"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Possible Causes & Solutions:"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Google Play Store not installed/updated:"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Ensure Google Play Store is installed and updated"}),"\n",(0,i.jsx)(e.li,{children:"Test on real device, not emulator"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"App not uploaded to Play Console:"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Upload app to Internal Testing track minimum"}),"\n",(0,i.jsx)(e.li,{children:"Wait for processing (can take several hours)"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Package name mismatch:"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-kotlin",children:'// Ensure applicationId matches Play Console\nandroid {\n    defaultConfig {\n        applicationId = "com.yourcompany.yourapp"\n    }\n}\n'})}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Developer account issues:"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Verify Google Play Developer account is active"}),"\n",(0,i.jsx)(e.li,{children:"Complete merchant agreement"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"ios-connection-issues",children:"iOS Connection Issues"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Problem:"})," Connection fails on iOS"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Solutions:"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Sandbox environment:"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Test on real device with sandbox account"}),"\n",(0,i.jsx)(e.li,{children:"Don't sign in to sandbox account in Settings"}),"\n",(0,i.jsx)(e.li,{children:"Only sign in when prompted during purchase"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"App Store Connect setup:"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:'Verify products are "Ready to Submit"'}),"\n",(0,i.jsx)(e.li,{children:"Complete agreements in ASC"}),"\n",(0,i.jsx)(e.li,{children:"Wait up to 24 hours for product propagation"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"product-loading-issues",children:"Product Loading Issues"}),"\n",(0,i.jsx)(e.h3,{id:"products-not-loading",children:"Products Not Loading"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Problem:"})," ",(0,i.jsx)(e.code,{children:"getProducts()"})," returns empty list"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Debugging Steps:"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Verify product IDs:"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-kotlin",children:'// Enable debug logging\n// Check exact product ID matching\ntry {\n    val products = kmpIapInstance.fetchProducts {\n        skus = listOf("exact.product.id.from.store")\n        type = ProductQueryType.InApp\n    }\n    println("Loaded products: ${products.size}")\n} catch (e: PurchaseError) {\n    println("Error loading products: $e")\n}\n'})}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Check store console:"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:'iOS: Products "Ready to Submit" in App Store Connect'}),"\n",(0,i.jsx)(e.li,{children:'Android: Products "Active" in Play Console'}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Wait for propagation:"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"New products can take 24+ hours to be available"}),"\n",(0,i.jsx)(e.li,{children:"Try with existing, known-working products first"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"ios-products-not-loading",children:"iOS Products Not Loading"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Specific Solutions:"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Bundle ID verification:"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Check bundle ID in Xcode matches App Store Connect"}),"\n",(0,i.jsx)(e.li,{children:"Verify in Info.plist"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Agreements verification:"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Check App Store Connect > Agreements, Tax, and Banking"}),"\n",(0,i.jsx)(e.li,{children:"Ensure Paid Applications Agreement is active"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Product status:"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:'Products must be "Ready to Submit" or "Approved"'}),"\n",(0,i.jsx)(e.li,{children:"Check in App Store Connect > Features > In-App Purchases"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"android-products-not-loading",children:"Android Products Not Loading"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Specific Solutions:"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"App upload requirement:"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# Build and upload APK/AAB to Play Console\n./gradlew bundleRelease\n"})}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Package name verification:"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["Verify ",(0,i.jsx)(e.code,{children:"applicationId"})," in build.gradle.kts"]}),"\n",(0,i.jsx)(e.li,{children:"Must exactly match Play Console"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"License testing:"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Add test accounts in Play Console > Setup > License testing"}),"\n",(0,i.jsx)(e.li,{children:"Use test accounts for testing"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"purchase-issues",children:"Purchase Issues"}),"\n",(0,i.jsx)(e.h3,{id:"purchase-flow-not-working",children:"Purchase Flow Not Working"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Problem:"})," Purchase request doesn't trigger system dialog"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Debugging:"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Check initialization:"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-kotlin",children:'// Ensure IAP is initialized before purchase\nval isConnected = kmpIapInstance.isConnected()\nif (!isConnected) {\n    println("IAP not initialized")\n    return\n}\n'})}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Verify product exists:"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-kotlin",children:'// Check if products are loaded\nval products = loadedProducts\nif (products.none { it.productId == productId }) {\n    println("Product not found: $productId")\n    return\n}\n'})}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Check state observers:"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-kotlin",children:'// Ensure observers are set up before purchase\nscope.launch {\n    kmpIapInstance.purchaseUpdatedListener.collect { purchase ->\n        purchase?.let {\n            println("Purchase updated: ${it.productId}")\n        }\n    }\n}\n\nscope.launch {\n    kmpIapInstance.purchaseErrorListener.collect { error ->\n        error?.let {\n            println("Purchase error: ${it.message}")\n        }\n    }\n}\n'})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"transaction-not-completing",children:"Transaction Not Completing"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Problem:"})," Purchase succeeds but transaction doesn't complete"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Solution:"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-kotlin",children:'private suspend fun handlePurchaseUpdate(purchase: Purchase) {\n    // Assuming kmpIAP is available as class property or use kmpIapInstance\n    try {\n        // IMPORTANT: Always complete transactions\n        val success = kmpIapInstance.finishTransaction(\n            purchase = purchase,\n            isConsumable = isConsumable(purchase.productId)\n        )\n        \n        if (success) {\n            println("Transaction completed successfully")\n        } else {\n            println("Failed to complete transaction")\n        }\n        \n        // Clear purchase state\n        // No need to clear purchase with new API\n    } catch (e: Exception) {\n        println("Failed to complete transaction: $e")\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"already-owned-error",children:'"Already Owned" Error'}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Problem:"}),' Getting "already owned" error on Android']}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Solutions:"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Check for existing purchases:"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-kotlin",children:"// For consumable products\nscope.launch {\n    val purchases = kmpIapInstance.getAvailablePurchases()\n    purchases.filter { isConsumable(it.productId) }\n        .forEach { purchase ->\n            // Consume the purchase\n            kmpIapInstance.finishTransaction(\n                purchase = purchase,\n                isConsumable = true\n            )\n        }\n}\n"})}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Clear test purchases:"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"In Google Play Store app: Menu > Account > Purchase history"}),"\n",(0,i.jsx)(e.li,{children:"Cancel test purchases"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"testing-issues",children:"Testing Issues"}),"\n",(0,i.jsx)(e.h3,{id:"sandbox-testing-problems-ios",children:"Sandbox Testing Problems (iOS)"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Problem:"})," Sandbox purchases not working"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Solutions:"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Account management:"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Create fresh sandbox accounts in App Store Connect"}),"\n",(0,i.jsx)(e.li,{children:"Don't sign in to sandbox account in Settings"}),"\n",(0,i.jsx)(e.li,{children:"Only sign in when prompted during purchase"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Purchase history:"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Clear purchase history in Settings > App Store > Sandbox Account"}),"\n",(0,i.jsx)(e.li,{children:"Use different sandbox accounts for different test scenarios"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Network issues:"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Test on real device with cellular/different WiFi"}),"\n",(0,i.jsx)(e.li,{children:"Sandbox can be unstable, try multiple times"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"test-purchases-not-working-android",children:"Test Purchases Not Working (Android)"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Problem:"})," Test purchases failing on Android"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Solutions:"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"License testers:"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-text",children:"Play Console > Setup > License testing > License Testers\nAdd Gmail accounts for testing\n"})}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Test tracks:"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Upload app to Internal Testing minimum"}),"\n",(0,i.jsx)(e.li,{children:"Join testing program with test account"}),"\n",(0,i.jsx)(e.li,{children:"Install from Play Store (not sideload)"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Account verification:"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Use Gmail account added as license tester"}),"\n",(0,i.jsx)(e.li,{children:"Clear Play Store cache/data if needed"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"runtime-errors",children:"Runtime Errors"}),"\n",(0,i.jsx)(e.h3,{id:"stateflow-collection-errors",children:"StateFlow Collection Errors"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Problem:"})," Multiple collectors or flow errors"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Solution:"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-kotlin",children:"class PurchaseManager : ViewModel() {\n    private val kmpIAP = KmpIAP()\n    \n    init {\n        initializeIAP()\n        setupObservers()\n    }\n    \n    private fun initializeIAP() {\n        viewModelScope.launch {\n            kmpIAP.initConnection()\n        }\n    }\n    \n    private fun setupObservers() {\n        // Use viewModelScope for automatic cancellation\n        viewModelScope.launch {\n            kmpIAP.purchaseUpdatedListener.collect { purchase ->\n                handlePurchase(purchase)\n            }\n        }\n        \n        viewModelScope.launch {\n            kmpIAP.purchaseErrorListener.collect { error ->\n                handleError(error)\n            }\n        }\n    }\n    \n    override fun onCleared() {\n        super.onCleared()\n        // Dispose KmpIAP resources\n        kmpIAP.dispose()\n    }\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"memory-leaks",children:"Memory Leaks"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Problem:"})," App crashes or memory issues"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Solution:"})," Always clean up resources:"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-kotlin",children:"class IAPService : ViewModel() {\n    private val kmpIAP = KmpIAP()\n    \n    init {\n        viewModelScope.launch {\n            kmpIAP.initConnection()\n        }\n    }\n    \n    override fun onCleared() {\n        super.onCleared()\n        // Dispose IAP resources\n        kmpIAP.dispose()\n    }\n}\n"})}),"\n",(0,i.jsx)(e.h2,{id:"receipt-validation-issues",children:"Receipt Validation Issues"}),"\n",(0,i.jsx)(e.h3,{id:"ios-receipt-validation",children:"iOS Receipt Validation"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Problem:"})," Receipt validation fails"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Solutions:"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Receipt data retrieval:"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-kotlin",children:'private suspend fun validateIOSPurchase(purchase: Purchase) {\n    val receipt = purchase.transactionReceipt\n    if (receipt == null) {\n        println("No receipt data available")\n        return\n    }\n    \n    // Send to your server for validation\n    val isValid = api.validateIOSReceipt(\n        receipt = receipt,\n        isProduction = !BuildConfig.DEBUG\n    )\n}\n'})}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Server validation:"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["Use production URL for live app: ",(0,i.jsx)(e.code,{children:"https://buy.itunes.apple.com/verifyReceipt"})]}),"\n",(0,i.jsxs)(e.li,{children:["Use sandbox URL for testing: ",(0,i.jsx)(e.code,{children:"https://sandbox.itunes.apple.com/verifyReceipt"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"android-receipt-validation",children:"Android Receipt Validation"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Problem:"})," Purchase token validation fails"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Solution:"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-kotlin",children:'// Use Google Play Developer API for server-side validation\nprivate suspend fun validateAndroidPurchase(purchase: Purchase) {\n    val purchaseToken = purchase.purchaseToken\n    if (purchaseToken == null) {\n        println("No purchase token available")\n        return\n    }\n    \n    // Send to your server\n    val isValid = api.validateAndroidPurchase(\n        token = purchaseToken,\n        productId = purchase.productId,\n        packageName = BuildConfig.APPLICATION_ID\n    )\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"debug-tools",children:"Debug Tools"}),"\n",(0,i.jsx)(e.h3,{id:"enable-debug-logging",children:"Enable Debug Logging"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-kotlin",children:'// Add logging to track IAP flow\nclass DebugIAPHelper(scope: CoroutineScope) {\n    \n    private val kmpIAP = KmpIAP()\n    \n    init {\n        scope.launch {\n            val connected = kmpIAP.initConnection()\n            println("[IAP] Connection state: $connected")\n        }\n        \n        scope.launch {\n            kmpIAP.purchaseErrorListener.collect { error ->\n                println("[IAP] Error: ${error.code} - ${error.message}")\n            }\n        }\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"check-connection-status",children:"Check Connection Status"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-kotlin",children:'suspend fun debugConnection() {\n    try {\n        kmpIapInstance.initConnection()\n        println("Connection initialized")\n\n        // Test with known product\n        val testProductId = when (getCurrentPlatform()) {\n            IapPlatform.Android -> "android.test.purchased"\n            IapPlatform.Ios -> "your.test.product"\n        }\n\n        val products = kmpIapInstance.fetchProducts {\n            skus = listOf(testProductId)\n            type = ProductQueryType.InApp\n        }\n        println("Test products loaded: ${products.size}")\n    } catch (e: PurchaseError) {\n        println("Debug error: $e")\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"common-error-codes",children:"Common Error Codes"}),"\n",(0,i.jsx)(e.h3,{id:"understanding-error-codes",children:"Understanding Error Codes"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-kotlin",children:'fun handleError(error: PurchaseError) {\n    when (error.code) {\n        ErrorCode.UserCancelled -> {\n            // User cancelled - no action needed\n        }\n        ErrorCode.NetworkError -> {\n            showRetryDialog("Network error. Please try again.")\n        }\n        ErrorCode.AlreadyOwned -> {\n            // Refresh purchases\n            scope.launch {\n                kmpIapInstance.syncPurchases()\n            }\n        }\n        ErrorCode.ServiceDisconnected -> {\n            // Reconnect\n            scope.launch {\n                kmpIapInstance.initConnection()\n            }\n        }\n        else -> {\n            showError("Purchase failed: ${error.message}")\n        }\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"getting-help",children:"Getting Help"}),"\n",(0,i.jsx)(e.p,{children:"If you're still experiencing issues:"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Check logs:"})," Enable debug logging and check console output"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Minimal reproduction:"})," Create minimal example that reproduces issue"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Platform testing:"})," Test on both iOS and Android"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Version check:"})," Ensure you're using latest library version"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"GitHub Issues:"})," ",(0,i.jsx)(e.a,{href:"https://github.com/hyochan/kmp-iap/issues",children:"Report bugs"})," with detailed information"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"issue-report-template",children:"Issue Report Template"}),"\n",(0,i.jsx)(e.p,{children:"When reporting issues, include:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-text",children:"**Platform:** iOS/Android/Both\n**Library Version:** kmp-iap x.x.x\n**Kotlin Version:** x.x.x\n**Device:** Real device/Simulator/Emulator\n\n**Issue Description:**\nClear description of the problem\n\n**Steps to Reproduce:**\n1. Step one\n2. Step two\n3. Step three\n\n**Expected Behavior:**\nWhat should happen\n\n**Actual Behavior:**\nWhat actually happens\n\n**Logs:**\n```text\nRelevant console output\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Sample Code:"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-kotlin",children:"// Minimal code that reproduces the issue\n"})}),"\n",(0,i.jsx)(e.p,{children:"This comprehensive troubleshooting guide should help developers resolve most common issues with kmp-iap."})]})}function u(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(h,{...n})}):h(n)}},5159:(n,e,s)=>{s.d(e,{A:()=>o});s(6540);var i=s(6025),r=s(7856),l=s(4848);function o({className:n="iapkit-banner",style:e}){const s=(0,i.A)("/img/iapkit-banner.gif");return(0,l.jsx)("div",{className:n,style:e,children:(0,l.jsx)("a",{href:r.V,target:"_blank",rel:"noopener noreferrer",onClick:async()=>{try{await fetch(r.I,{method:"POST",mode:"no-cors"})}catch(n){console.error("Failed to track banner click:",n)}},style:{display:"block",textAlign:"center",marginBottom:"20px",textDecoration:"none",cursor:"pointer"},children:(0,l.jsx)("img",{src:s,alt:"IAPKit - In-App Purchase Made Simple",style:{height:"auto",borderRadius:"8px",objectFit:"contain"}})})})}},7856:(n,e,s)=>{s.d(e,{I:()=>r,V:()=>i});const i="https://iapkit.com",r="https://www.hyo.dev/api/ad-banner/cmjf0l20n0002249hjrwmgob3"},8453:(n,e,s)=>{s.d(e,{R:()=>o,x:()=>t});var i=s(6540);const r={},l=i.createContext(r);function o(n){const e=i.useContext(l);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function t(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:o(n.components),i.createElement(l.Provider,{value:e},n.children)}}}]);