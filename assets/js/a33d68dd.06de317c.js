"use strict";(self.webpackChunkkmp_iap_docs=self.webpackChunkkmp_iap_docs||[]).push([[4388],{7061:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>c,toc:()=>a});var s=i(4848),r=i(8453);const l={title:"Core Methods",sidebar_position:3},t="Core Methods",c={id:"api/core-methods",title:"Core Methods",description:"Essential methods for implementing in-app purchases with kmp-iap, now 100% OpenIAP specification compliant. All methods support both iOS and Android platforms with unified APIs using Kotlin coroutines.",source:"@site/docs/api/core-methods.md",sourceDirName:"api",slug:"/api/core-methods",permalink:"/kmp-iap/docs/api/core-methods",draft:!1,unlisted:!1,editUrl:"https://github.com/hyochan/kmp-iap/tree/main/docs/docs/api/core-methods.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"Core Methods",sidebar_position:3},sidebar:"docsSidebar",previous:{title:"Types",permalink:"/kmp-iap/docs/api/types"},next:{title:"Listeners",permalink:"/kmp-iap/docs/api/listeners"}},o={},a=[{value:"Version Information",id:"version-information",level:2},{value:"Connection Management",id:"connection-management",level:2},{value:"initConnection()",id:"initconnection",level:3},{value:"endConnection()",id:"endconnection",level:3},{value:"Product Loading",id:"product-loading",level:2},{value:"requestProducts()",id:"requestproducts",level:3},{value:"v1.0.0-rc (Current) - DSL API",id:"v100-rc-current---dsl-api",level:4},{value:"v1.0.0-beta",id:"v100-beta",level:4},{value:"Purchase Processing",id:"purchase-processing",level:2},{value:"requestPurchase()",id:"requestpurchase",level:3},{value:"v1.0.0-rc (Current) - DSL API",id:"v100-rc-current---dsl-api-1",level:4},{value:"v1.0.0-beta",id:"v100-beta-1",level:4},{value:"Transaction Management",id:"transaction-management",level:2},{value:"finishTransaction()",id:"finishtransaction",level:3},{value:"Purchase History",id:"purchase-history",level:2},{value:"getAvailablePurchases()",id:"getavailablepurchases",level:3},{value:"getPurchaseHistories()",id:"getpurchasehistories",level:3},{value:"Event Flows",id:"event-flows",level:2},{value:"Purchase Event Flows",id:"purchase-event-flows",level:3},{value:"Platform-Specific Methods",id:"platform-specific-methods",level:2},{value:"iOS-Specific Methods",id:"ios-specific-methods",level:3},{value:"clearTransactionIOS()",id:"cleartransactionios",level:4},{value:"clearProductsIOS()",id:"clearproductsios",level:4},{value:"getPromotedProductIOS()",id:"getpromotedproductios",level:4},{value:"presentCodeRedemptionSheetIOS()",id:"presentcoderedemptionsheetios",level:4},{value:"getStorefrontIOS()",id:"getstorefrontios",level:4},{value:"iOS-Specific Alternative Billing",id:"ios-specific-alternative-billing",level:3},{value:"canPresentExternalPurchaseNoticeIOS()",id:"canpresentexternalpurchasenoticeios",level:4},{value:"presentExternalPurchaseNoticeSheetIOS()",id:"presentexternalpurchasenoticesheetios",level:4},{value:"presentExternalPurchaseLinkIOS()",id:"presentexternalpurchaselinkios",level:4},{value:"Android-Specific Methods",id:"android-specific-methods",level:3},{value:"acknowledgePurchaseAndroid()",id:"acknowledgepurchaseandroid",level:4},{value:"consumePurchaseAndroid()",id:"consumepurchaseandroid",level:4},{value:"deepLinkToSubscriptions()",id:"deeplinktosubscriptions",level:4},{value:"Android-Specific Alternative Billing",id:"android-specific-alternative-billing",level:3},{value:"checkAlternativeBillingAvailabilityAndroid()",id:"checkalternativebillingavailabilityandroid",level:4},{value:"showAlternativeBillingDialogAndroid()",id:"showalternativebillingdialogandroid",level:4},{value:"createAlternativeBillingTokenAndroid()",id:"createalternativebillingtokenandroid",level:4},{value:"Alternative Billing Configuration",id:"alternative-billing-configuration",level:4},{value:"Complete Alternative Billing Flow Example",id:"complete-alternative-billing-flow-example",level:4},{value:"Subscription Management",id:"subscription-management",level:2},{value:"getActiveSubscriptions()",id:"getactivesubscriptions",level:3},{value:"hasActiveSubscriptions()",id:"hasactivesubscriptions",level:3},{value:"Validation",id:"validation",level:2},{value:"validateReceipt()",id:"validatereceipt",level:3},{value:"isPurchaseValid()",id:"ispurchasevalid",level:3},{value:"Utility Methods",id:"utility-methods",level:2},{value:"getStore()",id:"getstore",level:3},{value:"canMakePayments()",id:"canmakepayments",level:3},{value:"getVersion()",id:"getversion",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"See Also",id:"see-also",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"core-methods",children:"Core Methods"}),"\n",(0,s.jsxs)(n.p,{children:["Essential methods for implementing in-app purchases with kmp-iap, now ",(0,s.jsx)(n.strong,{children:"100% OpenIAP specification compliant"}),". All methods support both iOS and Android platforms with unified APIs using Kotlin coroutines."]}),"\n",(0,s.jsx)(n.h2,{id:"version-information",children:"Version Information"}),"\n",(0,s.jsxs)(n.admonition,{title:"Version Differences",type:"info",children:[(0,s.jsx)(n.p,{children:"This documentation covers both:"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"v1.0.0-rc"})," (Current) - Simplified API without wrapper classes"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"v1.0.0-beta"})," - Previous API with wrapper classes"]}),"\n"]})]}),"\n",(0,s.jsxs)(n.p,{children:["\u26a0\ufe0f ",(0,s.jsx)(n.strong,{children:"Platform Differences"}),": While the API is unified, there are important differences between iOS and Android implementations. Each method documents platform-specific behavior."]}),"\n",(0,s.jsx)(n.h2,{id:"connection-management",children:"Connection Management"}),"\n",(0,s.jsx)(n.h3,{id:"initconnection",children:"initConnection()"}),"\n",(0,s.jsx)(n.p,{children:"Initializes the connection to the platform store."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"suspend fun initConnection(): Boolean\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Returns"}),": ",(0,s.jsx)(n.code,{children:"true"})," if connection successful, ",(0,s.jsx)(n.code,{children:"false"})," otherwise"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Description"}),": Establishes connection with the App Store (iOS) or Google Play Store (Android). Must be called before any other IAP operations."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Platform Differences"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"iOS"}),": Connects to StoreKit 2 (iOS 15+)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Android"}),": Connects to Google Play Billing Client v8+"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:'import io.github.hyochan.kmpiap.kmpIapInstance\n\nval connected = kmpIapInstance.initConnection()\nif (connected) {\n    println("IAP connection initialized successfully")\n} else {\n    println("Failed to initialize IAP connection")\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Throws"}),": ",(0,s.jsx)(n.code,{children:"PurchaseError"})," if connection fails"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"See Also"}),": ",(0,s.jsx)(n.a,{href:"#endconnection",children:"endConnection()"}),", ",(0,s.jsx)(n.a,{href:"/kmp-iap/docs/guides/lifecycle",children:"Connection Lifecycle"})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"endconnection",children:"endConnection()"}),"\n",(0,s.jsx)(n.p,{children:"Ends the connection to the platform store and cleans up resources."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"suspend fun endConnection()\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Returns"}),": Unit (void)"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Description"}),": Cleanly closes the store connection and frees resources. Should be called when IAP functionality is no longer needed."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"import io.github.hyochan.kmpiap.kmpIapInstance\n\n// In your cleanup code\noverride fun onCleared() {\n    scope.launch {\n        kmpIapInstance.endConnection()\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"product-loading",children:"Product Loading"}),"\n",(0,s.jsx)(n.h3,{id:"requestproducts",children:"requestProducts()"}),"\n",(0,s.jsx)(n.p,{children:"Loads product information from the store."}),"\n",(0,s.jsx)(n.h4,{id:"v100-rc-current---dsl-api",children:"v1.0.0-rc (Current) - DSL API"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"suspend fun requestProducts(\n    builder: ProductsRequestBuilder.() -> Unit\n): List<Product>\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Parameters"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"builder"})," - DSL builder for configuring the request"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Returns"}),": List of products with pricing and metadata"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:'import io.github.hyochan.kmpiap.kmpIapInstance\nimport io.github.hyochan.kmpiap.ProductQueryType\n\n// Load in-app products using DSL\nval products = kmpIapInstance.fetchProducts {\n    skus = listOf("coins_100", "coins_500", "remove_ads")\n    type = ProductQueryType.InApp\n}\n\n// Load subscriptions using DSL\nval subscriptions = kmpIapInstance.fetchProducts {\n    skus = listOf("premium_monthly", "premium_yearly")\n    type = ProductQueryType.Subscription\n}\n'})}),"\n",(0,s.jsx)(n.h4,{id:"v100-beta",children:"v1.0.0-beta"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"suspend fun requestProducts(params: ProductRequest): List<Product>\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:'val products = kmpIapInstance.fetchProducts {\n    skus = listOf("coins_100", "coins_500")\n    type = ProductQueryType.InApp\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Platform Differences"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"iOS"}),": Uses StoreKit 2 API for product requests"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Android"}),": Uses ",(0,s.jsx)(n.code,{children:"queryProductDetailsAsync()"})," with automatic product type detection"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"purchase-processing",children:"Purchase Processing"}),"\n",(0,s.jsx)(n.h3,{id:"requestpurchase",children:"requestPurchase()"}),"\n",(0,s.jsx)(n.p,{children:"Initiates a purchase using OpenIAP-compliant request structure."}),"\n",(0,s.jsx)(n.h4,{id:"v100-rc-current---dsl-api-1",children:"v1.0.0-rc (Current) - DSL API"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"suspend fun requestPurchase(\n    builder: PurchaseRequestBuilder.() -> Unit\n): Purchase\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Parameters"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"builder"})," - DSL builder for configuring platform-specific purchase options"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Returns"}),": Purchase object implementing ",(0,s.jsx)(n.code,{children:"PurchaseCommon"})," interface following OpenIAP specification"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:'import io.github.hyochan.kmpiap.kmpIapInstance\nimport io.github.hyochan.kmpiap.*\n\n// Cross-platform purchase using DSL\nkmpIapInstance.requestPurchase {\n    ios {\n        sku = "premium_upgrade"\n        quantity = 1\n    }\n    android {\n        skus = listOf("premium_upgrade")\n    }\n}\n\n// iOS-only purchase\nkmpIapInstance.requestPurchase {\n    ios {\n        sku = "coins_100"\n        quantity = 5\n        appAccountToken = "token_456"\n    }\n}\n\n// Android-only purchase\nkmpIapInstance.requestPurchase {\n    android {\n        skus = listOf("coins_100")\n        obfuscatedAccountIdAndroid = "user_123"\n        obfuscatedProfileIdAndroid = "profile_456"\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h4,{id:"v100-beta-1",children:"v1.0.0-beta"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"suspend fun requestPurchase(request: RequestPurchaseProps): Purchase\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:'kmpIapInstance.requestPurchase {\n    ios {\n        sku = "premium_upgrade"\n        quantity = 1\n    }\n    android {\n        skus = listOf("premium_upgrade")\n    }\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Platform Differences"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"iOS"}),": Supports App Account Token for fraud prevention"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Android"}),": Supports obfuscated user IDs and automatic Activity detection"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"transaction-management",children:"Transaction Management"}),"\n",(0,s.jsx)(n.h3,{id:"finishtransaction",children:"finishTransaction()"}),"\n",(0,s.jsx)(n.p,{children:"Completes a transaction after successful purchase processing."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"suspend fun finishTransaction(\n    purchase: Purchase,\n    isConsumable: Boolean? = null\n): Boolean\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Parameters"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"purchase"})," - The purchase to finish"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"isConsumable"})," - Whether the product is consumable (null for auto-detection)"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Returns"}),": ",(0,s.jsx)(n.code,{children:"true"})," if transaction was successfully finished, ",(0,s.jsx)(n.code,{children:"false"})," otherwise"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:'import io.github.hyochan.kmpiap.kmpIapInstance\n\n\n// For consumable products\nval success = kmpIapInstance.finishTransaction(\n    purchase = purchase.toPurchaseInput(),\n    isConsumable = true\n)\nif (success) {\n    println("Transaction finished successfully")\n}\n\n// For subscriptions (acknowledge only, don\'t consume)\nval acknowledged = kmpIapInstance.finishTransaction(\n    purchase = purchase.toPurchaseInput(),\n    isConsumable = false\n)\nif (acknowledged) {\n    println("Subscription acknowledged")\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Platform Behavior"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"iOS"}),": Calls ",(0,s.jsx)(n.code,{children:"finish()"})," on the transaction"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Android"}),":","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Consumables: Calls ",(0,s.jsx)(n.code,{children:"consumeAsync"})]}),"\n",(0,s.jsxs)(n.li,{children:["Non-consumables/Subscriptions: Calls ",(0,s.jsx)(n.code,{children:"acknowledgePurchase"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u26a0\ufe0f ",(0,s.jsx)(n.strong,{children:"Important"}),": Subscriptions should NEVER be consumed. They should only be acknowledged once."]}),"\n",(0,s.jsx)(n.h2,{id:"purchase-history",children:"Purchase History"}),"\n",(0,s.jsx)(n.h3,{id:"getavailablepurchases",children:"getAvailablePurchases()"}),"\n",(0,s.jsx)(n.p,{children:"Gets all available (unconsumed/active) purchases."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"suspend fun getAvailablePurchases(options: PurchaseOptions? = null): List<Purchase>\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Returns"}),": List of available purchases"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:'import io.github.hyochan.kmpiap.kmpIapInstance\n\nval purchases = kmpIapInstance.getAvailablePurchases()\npurchases.forEach { purchase ->\n    println("Product: \\${purchase.productId}")\n    println("Date: \\${purchase.transactionDate}")\n    \n    // Check acknowledgment status (Android)\n    if (purchase.acknowledgedAndroid == true) {\n        println("Already acknowledged")\n    }\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Platform Differences"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"iOS"}),": Returns active subscriptions and non-consumed purchases"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Android"}),": Queries both INAPP and SUBS purchases separately"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"getpurchasehistories",children:"getPurchaseHistories()"}),"\n",(0,s.jsx)(n.p,{children:"Gets purchase history including consumed items."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"suspend fun getPurchaseHistories(options: PurchaseOptions? = null): List<ProductPurchase>\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Returns"}),": List of historical purchases"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note"}),": Android Billing Client v6+ no longer provides purchase history. This method returns an empty list on Android."]}),"\n",(0,s.jsx)(n.h2,{id:"event-flows",children:"Event Flows"}),"\n",(0,s.jsx)(n.h3,{id:"purchase-event-flows",children:"Purchase Event Flows"}),"\n",(0,s.jsx)(n.p,{children:"All purchase events are exposed via Kotlin Flow for reactive programming:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"// Purchase updates\nval purchaseUpdatedListener: Flow<Purchase>\n\n// Purchase errors\nval purchaseErrorListener: Flow<PurchaseError>\n\n// Promoted products (iOS only)\nval promotedProductListener: Flow<String?>\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example Usage"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:'import io.github.hyochan.kmpiap.kmpIapInstance\nimport kotlinx.coroutines.flow.collectLatest\n\n// Listen for purchase updates\nscope.launch {\n    kmpIapInstance.purchaseUpdatedListener.collectLatest { purchase ->\n        println("Purchase completed: \\${purchase.productId}")\n        // Deliver content to user\n        deliverContent(purchase.productId)\n        // Finish transaction\n        kmpIapInstance.finishTransaction(purchase, isConsumable = true)\n    }\n}\n\n// Listen for errors\nscope.launch {\n    kmpIapInstance.purchaseErrorListener.collectLatest { error ->\n        when (error.code) {\n            ErrorCode.E_USER_CANCELLED.name -> {\n                println("User cancelled purchase")\n            }\n            else -> {\n                println("Purchase error: \\${error.message}")\n            }\n        }\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"platform-specific-methods",children:"Platform-Specific Methods"}),"\n",(0,s.jsx)(n.h3,{id:"ios-specific-methods",children:"iOS-Specific Methods"}),"\n",(0,s.jsx)(n.h4,{id:"cleartransactionios",children:"clearTransactionIOS()"}),"\n",(0,s.jsx)(n.p,{children:"Clears pending transactions (iOS only)."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"suspend fun clearTransactionIOS()\n"})}),"\n",(0,s.jsx)(n.h4,{id:"clearproductsios",children:"clearProductsIOS()"}),"\n",(0,s.jsx)(n.p,{children:"Clears cached products (iOS only)."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"suspend fun clearProductsIOS()\n"})}),"\n",(0,s.jsx)(n.h4,{id:"getpromotedproductios",children:"getPromotedProductIOS()"}),"\n",(0,s.jsx)(n.p,{children:"Gets the currently promoted product (iOS only)."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"suspend fun getPromotedProductIOS(): String?\n"})}),"\n",(0,s.jsx)(n.h4,{id:"presentcoderedemptionsheetios",children:"presentCodeRedemptionSheetIOS()"}),"\n",(0,s.jsx)(n.p,{children:"Presents the App Store code redemption sheet."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"suspend fun presentCodeRedemptionSheetIOS()\n"})}),"\n",(0,s.jsx)(n.h4,{id:"getstorefrontios",children:"getStorefrontIOS()"}),"\n",(0,s.jsx)(n.p,{children:"Gets the App Store storefront information."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"suspend fun getStorefrontIOS(): String\n"})}),"\n",(0,s.jsx)(n.h3,{id:"ios-specific-alternative-billing",children:"iOS-Specific Alternative Billing"}),"\n",(0,s.jsx)(n.h4,{id:"canpresentexternalpurchasenoticeios",children:"canPresentExternalPurchaseNoticeIOS()"}),"\n",(0,s.jsx)(n.p,{children:"Check if the device can present an external purchase notice sheet. Requires iOS 18.2+."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"suspend fun canPresentExternalPurchaseNoticeIOS(): Boolean\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Returns"}),": ",(0,s.jsx)(n.code,{children:"true"})," if the device supports external purchase notice sheets"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Platform"}),": iOS 18.2+"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:'import io.github.hyochan.kmpiap.kmpIapInstance\n\nval canPresent = kmpIapInstance.canPresentExternalPurchaseNoticeIOS()\nif (canPresent) {\n    println("External purchase notice sheet is available")\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note"}),": This notice sheet must be presented before redirecting users to external purchase links on iOS 18.2+."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h4,{id:"presentexternalpurchasenoticesheetios",children:"presentExternalPurchaseNoticeSheetIOS()"}),"\n",(0,s.jsx)(n.p,{children:"Present an external purchase notice sheet to inform users about external purchases. This must be called before opening an external purchase link on iOS 18.2+."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"suspend fun presentExternalPurchaseNoticeSheetIOS(): ExternalPurchaseNoticeResultIOS\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Returns"}),": ",(0,s.jsx)(n.code,{children:"ExternalPurchaseNoticeResultIOS"})," with result status"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:'data class ExternalPurchaseNoticeResultIOS(\n    val error: String?,\n    val result: String? // "continue" or "dismissed"\n)\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Platform"}),": iOS 18.2+"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:'import io.github.hyochan.kmpiap.kmpIapInstance\n\nval result = kmpIapInstance.presentExternalPurchaseNoticeSheetIOS()\n\nif (result.error != null) {\n    println("Failed to present notice: ${result.error}")\n} else if (result.result == "continue") {\n    // User chose to continue to external purchase\n    println("User accepted external purchase notice")\n} else if (result.result == "dismissed") {\n    // User dismissed the sheet\n    println("User dismissed notice")\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"See also"}),": ",(0,s.jsx)(n.a,{href:"https://developer.apple.com/documentation/storekit/external-purchase",children:"StoreKit External Purchase documentation"})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h4,{id:"presentexternalpurchaselinkios",children:"presentExternalPurchaseLinkIOS()"}),"\n",(0,s.jsx)(n.p,{children:"Open an external purchase link in Safari to redirect users to your website for purchase. Requires iOS 16.0+."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"suspend fun presentExternalPurchaseLinkIOS(url: String): ExternalPurchaseLinkResultIOS\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Parameters"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"url"})," - The external purchase URL to open"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Returns"}),": ",(0,s.jsx)(n.code,{children:"ExternalPurchaseLinkResultIOS"})," with success status"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"data class ExternalPurchaseLinkResultIOS(\n    val error: String?,\n    val success: Boolean\n)\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Platform"}),": iOS 16.0+"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:'import io.github.hyochan.kmpiap.kmpIapInstance\n\nval result = kmpIapInstance.presentExternalPurchaseLinkIOS(\n    url = "https://your-site.com/checkout"\n)\n\nif (result.error != null) {\n    println("Failed to open link: ${result.error}")\n} else if (result.success) {\n    println("User redirected to external purchase website")\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Requirements"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Must configure entitlements in your iOS project"}),"\n",(0,s.jsx)(n.li,{children:"Requires Apple approval and proper provisioning profile with external purchase entitlements"}),"\n",(0,s.jsx)(n.li,{children:"URLs must be configured in Info.plist"}),"\n",(0,s.jsx)(n.li,{children:"iOS 16.0 or later"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Configuration Example"})," (Info.plist):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<plist>\n<dict>\n    \x3c!-- Countries where external purchases are supported --\x3e\n    <key>SKExternalPurchase</key>\n    <array>\n        <string>kr</string>\n        <string>nl</string>\n    </array>\n</dict>\n</plist>\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"See also"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://developer.apple.com/documentation/storekit/external-purchase",children:"StoreKit External Purchase documentation"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/kmp-iap/docs/guides/alternative-billing",children:"Alternative Billing Guide"})}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"android-specific-methods",children:"Android-Specific Methods"}),"\n",(0,s.jsx)(n.h4,{id:"acknowledgepurchaseandroid",children:"acknowledgePurchaseAndroid()"}),"\n",(0,s.jsx)(n.p,{children:"Acknowledges a purchase (Android only)."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"suspend fun acknowledgePurchaseAndroid(purchaseToken: String)\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Important"}),": Subscriptions must be acknowledged within 3 days or they will be refunded."]}),"\n",(0,s.jsx)(n.h4,{id:"consumepurchaseandroid",children:"consumePurchaseAndroid()"}),"\n",(0,s.jsx)(n.p,{children:"Consumes a purchase (Android only)."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"suspend fun consumePurchaseAndroid(purchaseToken: String)\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Warning"}),": Only use for consumable products. Never consume subscriptions."]}),"\n",(0,s.jsx)(n.h4,{id:"deeplinktosubscriptions",children:"deepLinkToSubscriptions()"}),"\n",(0,s.jsx)(n.p,{children:"Opens the Google Play subscription management page."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"suspend fun deepLinkToSubscriptions(options: DeepLinkOptions)\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:'import io.github.hyochan.kmpiap.kmpIapInstance\n\nkmpIapInstance.deepLinkToSubscriptions(\n    DeepLinkOptions(skuAndroid = "premium_monthly")\n)\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"android-specific-alternative-billing",children:"Android-Specific Alternative Billing"}),"\n",(0,s.jsx)(n.h4,{id:"checkalternativebillingavailabilityandroid",children:"checkAlternativeBillingAvailabilityAndroid()"}),"\n",(0,s.jsx)(n.p,{children:"Check if alternative billing is available for the current user. This must be called before showing the alternative billing dialog."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"suspend fun checkAlternativeBillingAvailabilityAndroid(): Boolean\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Returns"}),": ",(0,s.jsx)(n.code,{children:"true"})," if alternative billing is available, ",(0,s.jsx)(n.code,{children:"false"})," otherwise"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Platform"}),": Android"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:'import io.github.hyochan.kmpiap.kmpIapInstance\n\nval isAvailable = kmpIapInstance.checkAlternativeBillingAvailabilityAndroid()\nif (isAvailable) {\n    println("Alternative billing is available")\n} else {\n    println("Alternative billing not available for this user")\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Requirements"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Must initialize connection with alternative billing mode"}),"\n",(0,s.jsx)(n.li,{children:"User must be eligible for alternative billing (determined by Google)"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"See also"}),": ",(0,s.jsx)(n.a,{href:"https://developer.android.com/google/play/billing/alternative",children:"Google Play Alternative Billing documentation"})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h4,{id:"showalternativebillingdialogandroid",children:"showAlternativeBillingDialogAndroid()"}),"\n",(0,s.jsx)(n.p,{children:"Show Google's required information dialog to inform users about alternative billing. This must be called after checking availability and before processing payment."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"suspend fun showAlternativeBillingDialogAndroid(): Boolean\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Returns"}),": ",(0,s.jsx)(n.code,{children:"true"})," if user accepted, ",(0,s.jsx)(n.code,{children:"false"})," if user declined"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Platform"}),": Android"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:'import io.github.hyochan.kmpiap.kmpIapInstance\n\nval userAccepted = kmpIapInstance.showAlternativeBillingDialogAndroid()\nif (userAccepted) {\n    println("User accepted alternative billing")\n    // Proceed with your payment flow\n} else {\n    println("User declined alternative billing")\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note"}),": This dialog is required by Google Play's alternative billing policy. You must show this before redirecting users to your payment system."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h4,{id:"createalternativebillingtokenandroid",children:"createAlternativeBillingTokenAndroid()"}),"\n",(0,s.jsx)(n.p,{children:"Generate a reporting token after successfully processing payment through your payment system. This token must be reported to Google Play within 24 hours."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"suspend fun createAlternativeBillingTokenAndroid(): String?\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Returns"}),": Token string if successful, ",(0,s.jsx)(n.code,{children:"null"})," if failed"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Platform"}),": Android"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:'import io.github.hyochan.kmpiap.kmpIapInstance\n\n// After successfully processing payment in your system\nval token = kmpIapInstance.createAlternativeBillingTokenAndroid()\n\nif (token != null) {\n    println("Token created: $token")\n    // Send this token to your backend to report to Google\n    reportTokenToGooglePlay(token)\n} else {\n    println("Failed to create token")\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Important"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Token must be reported to Google Play backend within 24 hours"}),"\n",(0,s.jsx)(n.li,{children:"Requires server-side integration with Google Play Developer API"}),"\n",(0,s.jsx)(n.li,{children:"Failure to report will result in refund and possible account suspension"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h4,{id:"alternative-billing-configuration",children:"Alternative Billing Configuration"}),"\n",(0,s.jsx)(n.p,{children:"Configure alternative billing mode when initializing the connection:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"import io.github.hyochan.kmpiap.kmpIapInstance\nimport io.github.hyochan.kmpiap.openiap.AlternativeBillingModeAndroid\nimport io.github.hyochan.kmpiap.openiap.InitConnectionConfig\n\n// Initialize with alternative billing mode\nval config = InitConnectionConfig(\n    alternativeBillingModeAndroid = AlternativeBillingModeAndroid.UserChoice\n    // Or: AlternativeBillingModeAndroid.AlternativeOnly\n)\n\nval connected = kmpIapInstance.initConnection(config)\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Billing Modes"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"UserChoice"})," - Users choose between Google Play billing or your payment system"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"AlternativeOnly"})," - Only your payment system is available"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"None"})," - Default, no alternative billing"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h4,{id:"complete-alternative-billing-flow-example",children:"Complete Alternative Billing Flow Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:'import io.github.hyochan.kmpiap.kmpIapInstance\n\nsuspend fun purchaseWithAlternativeBilling(productId: String) {\n    // Step 1: Check availability\n    val isAvailable = kmpIapInstance.checkAlternativeBillingAvailabilityAndroid()\n    if (!isAvailable) {\n        throw Exception("Alternative billing not available")\n    }\n\n    // Step 2: Show required dialog\n    val userAccepted = kmpIapInstance.showAlternativeBillingDialogAndroid()\n    if (!userAccepted) {\n        throw Exception("User declined alternative billing")\n    }\n\n    // Step 3: Process payment in your system\n    val paymentResult = processPaymentInYourSystem(productId)\n    if (!paymentResult.success) {\n        throw Exception("Payment failed")\n    }\n\n    // Step 4: Create reporting token\n    val token = kmpIapInstance.createAlternativeBillingTokenAndroid()\n    if (token == null) {\n        throw Exception("Failed to create token")\n    }\n\n    // Step 5: Report to Google (must be done within 24 hours)\n    reportToGooglePlayBackend(token, productId, paymentResult)\n\n    println("Alternative billing purchase completed")\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"See also"}),": ",(0,s.jsx)(n.a,{href:"/kmp-iap/docs/guides/alternative-billing",children:"Alternative Billing Guide"})]}),"\n",(0,s.jsx)(n.h2,{id:"subscription-management",children:"Subscription Management"}),"\n",(0,s.jsx)(n.h3,{id:"getactivesubscriptions",children:"getActiveSubscriptions()"}),"\n",(0,s.jsx)(n.p,{children:"Gets all active subscriptions with detailed information."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"suspend fun getActiveSubscriptions(subscriptionIds: List<String>? = null): List<ActiveSubscription>\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Parameters"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"subscriptionIds"})," - Optional list of subscription IDs to check. If null, returns all active subscriptions"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Returns"}),": List of active subscriptions with platform-specific details"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:'import io.github.hyochan.kmpiap.kmpIapInstance\n\n// Get all active subscriptions\nval allActiveSubscriptions = kmpIapInstance.getActiveSubscriptions()\n\n// Get specific subscriptions\nval premiumSubscriptions = kmpIapInstance.getActiveSubscriptions(\n    listOf("premium_monthly", "premium_yearly")\n)\n\npremiumSubscriptions.forEach { subscription ->\n    println("Product: \\${subscription.productId}")\n    println("Active: \\${subscription.isActive}")\n    \n    // iOS-specific information\n    subscription.expirationDateIOS?.let { expDate ->\n        println("Expires: \\${Instant.fromEpochMilliseconds(expDate)}")\n    }\n    subscription.environmentIOS?.let { env ->\n        println("Environment: $env") // "Sandbox" or "Production"\n    }\n    subscription.daysUntilExpirationIOS?.let { days ->\n        println("Days until expiration: $days")\n    }\n    \n    // Android-specific information\n    subscription.autoRenewingAndroid?.let { autoRenew ->\n        println("Auto-renewing: $autoRenew")\n    }\n    \n    // Cross-platform\n    if (subscription.willExpireSoon == true) {\n        println("\u26a0\ufe0f Subscription expires soon!")\n    }\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Platform Differences"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"iOS"}),": Provides ",(0,s.jsx)(n.code,{children:"expirationDateIOS"}),", ",(0,s.jsx)(n.code,{children:"environmentIOS"}),", ",(0,s.jsx)(n.code,{children:"daysUntilExpirationIOS"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Android"}),": Provides ",(0,s.jsx)(n.code,{children:"autoRenewingAndroid"})," status"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Cross-platform"}),": ",(0,s.jsx)(n.code,{children:"willExpireSoon"})," (true if expiring within 7 days)"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"hasactivesubscriptions",children:"hasActiveSubscriptions()"}),"\n",(0,s.jsx)(n.p,{children:"Checks if the user has any active subscriptions."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"suspend fun hasActiveSubscriptions(subscriptionIds: List<String>? = null): Boolean\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Parameters"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"subscriptionIds"})," - Optional list of subscription IDs to check. If null, checks all subscriptions"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Returns"}),": ",(0,s.jsx)(n.code,{children:"true"})," if the user has at least one active subscription, ",(0,s.jsx)(n.code,{children:"false"})," otherwise"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:'import io.github.hyochan.kmpiap.kmpIapInstance\n\n// Check if user has any active subscriptions\nval hasAnySubscription = kmpIapInstance.hasActiveSubscriptions()\nif (hasAnySubscription) {\n    println("User has active subscriptions")\n    showPremiumFeatures()\n} else {\n    showSubscriptionOffer()\n}\n\n// Check specific subscription types\nval hasPremium = kmpIapInstance.hasActiveSubscriptions(\n    listOf("premium_monthly", "premium_yearly")\n)\nif (hasPremium) {\n    enablePremiumFeatures()\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Use Cases"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Feature gating based on subscription status"}),"\n",(0,s.jsx)(n.li,{children:"Showing/hiding subscription offers"}),"\n",(0,s.jsx)(n.li,{children:"Quick subscription status checks without detailed information"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"validation",children:"Validation"}),"\n",(0,s.jsx)(n.h3,{id:"validatereceipt",children:"validateReceipt()"}),"\n",(0,s.jsx)(n.p,{children:"Validates a purchase receipt (server-side validation recommended)."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"suspend fun validateReceipt(options: ValidationOptions): ValidationResult\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Parameters"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"options"})," - Validation options including receipt data"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Returns"}),": Validation result with status"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note"}),": Client-side validation is not secure. Always validate receipts on your server."]}),"\n",(0,s.jsx)(n.h3,{id:"ispurchasevalid",children:"isPurchaseValid()"}),"\n",(0,s.jsx)(n.p,{children:"Quick client-side purchase validation."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"suspend fun isPurchaseValid(purchase: Purchase): Boolean\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Returns"}),": ",(0,s.jsx)(n.code,{children:"true"})," if purchase appears valid"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"import io.github.hyochan.kmpiap.kmpIapInstance\n\nval isValid = kmpIapInstance.isPurchaseValid(purchase)\nif (isValid) {\n    // Proceed with server validation\n    validateOnServer(purchase)\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"utility-methods",children:"Utility Methods"}),"\n",(0,s.jsx)(n.h3,{id:"getstore",children:"getStore()"}),"\n",(0,s.jsx)(n.p,{children:"Gets the current store type."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"fun getStore(): Store\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Returns"}),": Store enum (APP_STORE, PLAY_STORE, AMAZON, or NONE)"]}),"\n",(0,s.jsx)(n.h3,{id:"canmakepayments",children:"canMakePayments()"}),"\n",(0,s.jsx)(n.p,{children:"Checks if the device can make payments."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"suspend fun canMakePayments(): Boolean\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Returns"}),": ",(0,s.jsx)(n.code,{children:"true"})," if payments are available"]}),"\n",(0,s.jsx)(n.h3,{id:"getversion",children:"getVersion()"}),"\n",(0,s.jsx)(n.p,{children:"Gets the library version."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"fun getVersion(): String\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Returns"}),': Version string (e.g., "KMP-IAP v1.0.0 (Android)")']}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Always handle errors"}),": Use try-catch blocks or collect error flows"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Finish transactions"}),": Always call ",(0,s.jsx)(n.code,{children:"finishTransaction()"})," after delivering content"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Check acknowledgment"}),": For Android, check if subscriptions are already acknowledged before re-acknowledging"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Monitor connection"}),": Check connection status before operations"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Use proper product types"}),": Specify ProductType.INAPP or ProductType.SUBS correctly"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Never consume subscriptions"}),": Only acknowledge subscriptions, never consume them"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Validate on server"}),": Always perform receipt validation on your server"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,s.jsxs)(n.p,{children:["All methods can throw ",(0,s.jsx)(n.code,{children:"PurchaseError"})," with specific error codes:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kotlin",children:"import io.github.hyochan.kmpiap.kmpIapInstance\n\ntry {\n    val purchase = kmpIapInstance.requestPurchase(request)\n} catch (e: PurchaseError) {\n    when (e.code) {\n        ErrorCode.E_USER_CANCELLED.name -> handleCancellation()\n        ErrorCode.E_ITEM_UNAVAILABLE.name -> handleUnavailable()\n        ErrorCode.E_NETWORK_ERROR.name -> handleNetworkError()\n        else -> handleGenericError(e)\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/kmp-iap/docs/api/types",children:"Types"})," - Type definitions used in methods"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/kmp-iap/docs/api/error-codes",children:"Error Codes"})," - Complete error code reference"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/kmp-iap/docs/api/listeners",children:"Events and Listeners"})," - Using Flow for events"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/kmp-iap/docs/examples/basic-store",children:"Examples"})," - Complete implementation examples"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>c});var s=i(6540);const r={},l=s.createContext(r);function t(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);